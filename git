FROM alpine

# Install git packages
RUN apk update && apk upgrade && apk add bash git openssh

# Setup git identity
ARG GIT_EMAIL=resources@docker.com
RUN git config --global user.email $GIT_EMAIL
ARG GIT_NAME=resources
RUN git config --global user.name $GIT_NAME

# Create and run cron script
ENV GIT_URL=""
ENV GIT_BRANCH=master
ENV GIT_CMD="echo 'Done!'"
ENV GIT_TIME=15
CMD echo -e 'git clone -b $GIT_BRANCH $GIT_URL data \n\
  cd data \n\
  while true; do \n\
    if ! git diff --quiet remotes/origin/HEAD; then \n\
      git reset --hard origin/master && git pull && $GIT_CMD \n\
    fi \n\
    sleep $GIT_TIME \n\
  done' >> pull.sh && \
  chmod +x pull.sh && \
  ./pull.sh