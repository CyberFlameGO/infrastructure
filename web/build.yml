steps:
  - id: build 
    name: gcr.io/cloud-builders/docker
    args:
      - build
      - --tag=gcr.io/$PROJECT_ID/web:$BRANCH_NAME
      - --cache-from=gcr.io/$PROJECT_ID/web:$BRANCH_NAME
      - --build-arg=BRANCH=$BRANCH_NAME
      - web
  - id: tag
    name: gcr.io/cloud-builders/docker
    args:
      - tag
      - gcr.io/$PROJECT_ID/web:master
      - gcr.io/$PROJECT_ID/web:latest
    wait_for:
      - build
images:
  - gcr.io/$PROJECT_ID/web
tags:
  - gcr.io/$PROJECT_ID/web:latest
  - gcr.io/$PROJECT_ID/web:master
  - gcr.io/$PROJECT_ID/web:staging
