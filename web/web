# Always build this Dockerfile with the --no-cache flag
FROM stratusnetwork/web:base

# Clone the latest repo and install changes
RUN ./clone.sh OCN "mv ../vendor vendor"
WORKDIR OCN
RUN bundle install

# Website role and port variables
ENV RAILS_ENV=development
ENV WEB_ROLE=octc
ENV WEB_PORT=3000

# Copy mongo config (override existing repository)
COPY mongoid.yml ./config/mongoid.yml

# Default to running rails with role on build
CMD rails $WEB_ROLE -b 0.0.0.0

# Create health check to monitor for downtime
HEALTHCHECK --start-period=15s CMD curl -f http://localhost:$WEB_PORT/ || exit 1

# Load ocn data repository (needs to be in this directory)
VOLUME /minecraft/repo/data